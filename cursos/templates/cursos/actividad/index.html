{% extends 'cabezal.html' %}

{% load static %}
{% load custom_filters %}

{% block titulo_pagina %}
    <title>{{ curso.NOMBRE_CURSO }} | ChugChillian</title>
{% endblock %}

{% block css_archivos %}
    <style>
        .player-layout {
            min-height: calc(100vh - 120px);
        }

        .sidebar-contenido {
            max-height: none;
            overflow: visible;
        }

    </style>
    <style>
        .player-layout {
            min-height: calc(100vh - 120px);
        }

        .sidebar-contenido {
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }

        /* ====== ACTIVIDAD PRINCIPAL ====== */
        .card-actividad {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 40%, #f3f4ff 100%);
            border-radius: 1.5rem;
        }

        .actividad-meta-pill {
            font-size: 0.8rem;
            padding: 0.25rem 0.6rem;
            border-radius: 999px;
            background-color: rgba(0, 0, 0, 0.04);
        }

        .actividad-tipo-badge {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: .06em;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            background-color: #fff3cd;
            color: #856404;
        }

        .actividad-titulo {
            font-size: 1.35rem;
        }

        /* ====== COMENTARIOS ====== */
        .card-comentarios {
            border-radius: 1.5rem;
        }

        .comentario-average {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .comentario-chip {
            font-size: 0.75rem;
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            background-color: #f1f3f5;
        }

        .comentario-item:last-child {
            border-bottom: none !important;
            padding-bottom: 0 !important;
            margin-bottom: 0 !important;
        }

        .comentario-texto {
            font-size: 0.95rem;
        }

        .comentario-usuario {
            font-size: 0.9rem;
        }

        .comentario-meta {
            font-size: 0.8rem;
        }
    </style>
    <style>

        .progreso-info .titulo {
            font-weight: 600;
            color: #444;
        }

        .progreso-info .valor {
            font-weight: bold;
            color: #4CAF50;
        }

    </style>
    <style>
        /* ====== LISTA LIMPIA TIPO UDEMY ====== */

        .accordion-button {
            cursor: default;
            background: #f8f9fa !important;
            color: #333;
            box-shadow: none !important;
        }

        .accordion-button::after {
            display: none;
        }

        .accordion-body {
            padding: 0 !important;
        }

        .list-group-item {
            border: none;
            border-bottom: 1px solid #edf0f3;
        }

        .list-group-item:hover {
            background: #f9f9f9;
        }

        a.text-body:hover {
            color: #0d6efd;
        }

    </style>
{% endblock %}

{% block insertar_progreso_curso %}
    <div class="nav-progreso">
        <canvas id="progressChart" width="40" height="40"></canvas>
    </div>

{% endblock %}
{% block contenido_pagina %}

    <div class="container-fluid py-4 player-layout bg-light">

        <!-- ZONA PRINCIPAL -->
        <div class="container-fluid">
            <div class="row g-3 align-items-stretch">

                {% include 'cursos/actividad/modales/izquierdo.html' %}
                {% include 'cursos/actividad/modales/derecho.html' %}

            </div>
        </div>

    </div>

{% endblock %}
{% block jvscript_archivos_defer %}
    <script>
        document.querySelectorAll(".chk-actividad").forEach(chk => {
            chk.addEventListener("change", function () {
                fetch("{% url 'marcar_actividad' %}", {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",
                        "Content-Type": "application/x-www-form-urlencoded"
                    },
                    body: `actividad_id=${this.dataset.id}&completado=${this.checked}`
                });
            });
        });
    </script>
    <script>
        const btnContenido = document.getElementById("btnContenido");
        const btnComentarios = document.getElementById("btnComentarios");

        const tabContenido = document.getElementById("tabContenido");
        const tabComentarios = document.getElementById("tabComentariosContent");

        btnContenido.addEventListener("click", () => {
            btnContenido.classList.add("active");
            btnComentarios.classList.remove("active");

            tabContenido.classList.remove("d-none");
            tabComentarios.classList.add("d-none");
        });

        btnComentarios.addEventListener("click", () => {
            btnComentarios.classList.add("active");
            btnContenido.classList.remove("active");

            tabComentarios.classList.remove("d-none");
            tabContenido.classList.add("d-none");
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const progreso = parseFloat("{{ PROGRESO_CURSO|default:0 }}");
            const canvas = document.getElementById("progressChart");

            if (!canvas) return;

            const ctx = canvas.getContext("2d");

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [progreso, 100 - progreso],
                        backgroundColor: ['#4CAF50', '#E6E6E6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '75%',
                    responsive: false,
                    plugins: {
                        legend: {display: false},
                        tooltip: {enabled: false}
                    }
                }
            });

        });
    </script>


{% endblock %}
